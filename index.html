<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Messaging Pro | Switch Account</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
  <script id="firebase-config" type="application/json">
  {
    "apiKey": "AIzaSyB9fmgduk-bcSRTPL6FdcKKgqvTtQoICpE",
    "authDomain": "university-outreach-log.firebaseapp.com",
    "projectId": "university-outreach-log",
    "storageBucket": "university-outreach-log.firebasestorage.app",
    "messagingSenderId": "566149647802",
    "appId": "1:566149647802:web:490c7cc3d10b7cd7732183"
  }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #050a15; color: white; overflow: hidden; }
    .wvu-blue { background-color: #002855; }
    .wvu-gold-text { color: #eaaa00; }
    .wvu-gold-bg { background-color: #eaaa00; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    #swipe-zone { touch-action: pan-y !important; }
    .active-tab { border-bottom: 2px solid #eaaa00; color: #eaaa00 !important; }
    .pane-item.active { color: #eaaa00; border-color: #eaaa00; background: rgba(234, 170, 0, 0.1); }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <header class="wvu-blue p-5 border-b-2 border-[#eaaa00] m-4 rounded-3xl flex justify-between items-center shadow-2xl">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 wvu-gold-bg rounded-xl flex items-center justify-center shadow-lg"><span class="font-black text-[#002855] text-lg">Y</span></div>
      <div>
        <h1 class="text-xl font-black tracking-tighter wvu-gold-text uppercase leading-none">Messaging Pro</h1>
        <p id="user-display" class="text-[9px] text-white/60 font-bold uppercase mt-1 tracking-widest">Loading Account...</p>
      </div>
    </div>
  </header>

  <nav class="bg-[#050a15] border-b border-slate-800 flex overflow-x-auto no-scrollbar">
    <button onclick="window.switchTab('chats')" id="tab-chats" class="flex-1 min-w-[80px] py-4 text-[9px] font-black uppercase tracking-widest text-slate-500">Chats</button>
    <button onclick="window.switchTab('ai')" id="tab-ai" class="flex-1 min-w-[80px] py-4 text-[9px] font-black uppercase tracking-widest text-slate-500">AI</button>
    <button onclick="window.switchTab('notes')" id="tab-notes" class="flex-1 min-w-[80px] py-4 text-[9px] font-black uppercase tracking-widest text-slate-500">Notes</button>
    <button onclick="window.switchTab('accounts')" id="tab-accounts" class="flex-1 min-w-[80px] py-4 text-[9px] font-black uppercase tracking-widest text-slate-500">Accounts</button>
  </nav>

  <div id="pane-bar-container" class="bg-slate-900/50 border-b border-slate-800 px-4 py-2 flex gap-2 overflow-x-auto no-scrollbar">
    <div id="chat-panes" class="flex gap-2">
        <button onclick="window.setPane('all')" class="pane-item active px-4 py-2 rounded-xl text-[8px] font-black uppercase border border-slate-700">All</button>
        <button onclick="window.setPane('group')" class="pane-item px-4 py-2 rounded-xl text-[8px] font-black uppercase border border-slate-700 text-slate-500">Groups</button>
        <button onclick="window.setPane('dm')" class="pane-item px-4 py-2 rounded-xl text-[8px] font-black uppercase border border-slate-700 text-slate-500">DMs</button>
    </div>
    <div id="account-panes" class="hidden flex gap-2">
        <button onclick="window.setAccountView('profile')" id="pane-profile" class="pane-item active px-4 py-2 rounded-xl text-[8px] font-black uppercase border border-slate-700">Active Profile</button>
        <button onclick="window.setAccountView('switch')" id="pane-switch" class="pane-item px-4 py-2 rounded-xl text-[8px] font-black uppercase border border-slate-700 text-slate-500">Switch Account</button>
    </div>
  </div>

  <main id="swipe-zone" class="flex-1 p-4 pb-40 max-w-2xl mx-auto w-full overflow-y-auto no-scrollbar">
    
    <div id="chats-view" class="hidden space-y-3">
        <div id="uni-list" class="space-y-3"></div>
    </div>

    <div id="accounts-view" class="hidden">
        <div id="view-profile" class="space-y-4">
            <div class="bg-slate-900 border border-slate-800 p-8 rounded-3xl text-center">
                <div class="w-20 h-20 wvu-gold-bg rounded-full mx-auto mb-4 flex items-center justify-center text-3xl font-black text-[#002855] shadow-xl">
                    <span id="user-initial">?</span>
                </div>
                <h2 id="user-email-display" class="text-sm font-bold text-white mb-1">Guest User</h2>
                <p class="text-[9px] text-slate-500 uppercase font-black tracking-tighter mb-6">Prospective PhD Applicant</p>
                <button onclick="window.processLogout()" class="w-full py-3 bg-red-900/20 border border-red-500/30 rounded-xl text-[10px] font-black uppercase text-red-400">Sign Out</button>
            </div>
        </div>

        <div id="view-switch" class="hidden space-y-4">
            <div class="bg-slate-900 border border-slate-800 p-6 rounded-3xl">
                <h3 class="text-[10px] font-black uppercase wvu-gold-text mb-4">Login to Another Account</h3>
                <input id="identity-email" type="email" placeholder="Email" class="w-full bg-[#050a15] border border-slate-800 p-4 rounded-xl text-xs mb-3 outline-none focus:border-[#eaaa00]" />
                <input id="identity-pass" type="password" placeholder="Password" class="w-full bg-[#050a15] border border-slate-800 p-4 rounded-xl text-xs mb-4 outline-none focus:border-[#eaaa00]" />
                <div class="flex gap-2">
                    <button onclick="window.processAuth()" class="flex-1 wvu-gold-bg text-[#002855] py-4 rounded-xl text-[10px] font-black uppercase">Sign In</button>
                    <button onclick="window.processSignUp()" class="flex-1 bg-slate-800 border border-slate-700 py-4 rounded-xl text-[10px] font-black uppercase">Register</button>
                </div>
            </div>
        </div>
    </div>

    <div id="ai-view" class="hidden"><div id="chat-container" class="space-y-4"></div></div>
    <div id="notes-view" class="hidden"><div id="vault-editor"></div></div>

  </main>

  <footer class="fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-[#050a15] to-transparent">
    <form id="chat-form" class="max-w-md mx-auto flex items-center gap-3">
      <button type="button" class="w-12 h-12 rounded-2xl wvu-blue border border-[#eaaa00]/30 wvu-gold-text font-bold">+</button>
      <input id="chat-input" type="text" placeholder="Message..." class="flex-1 bg-slate-800 border border-slate-700 rounded-2xl py-4 px-5 text-sm outline-none focus:border-[#eaaa00]" />
      <button type="submit" class="wvu-gold-bg p-3 rounded-xl text-[#002855]">âž¤</button>
    </form>
  </footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
import { getFirestore, collection, onSnapshot, query, orderBy, addDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

const config = JSON.parse(document.getElementById("firebase-config").textContent);
const app = initializeApp(config);
const auth = getAuth(app);
const db = getFirestore(app);
let currentUser = null;
const tabs = ['chats', 'ai', 'notes', 'accounts'];

onAuthStateChanged(auth, (user) => {
  if (user) { 
    currentUser = user; 
    document.getElementById("user-display").textContent = user.isAnonymous ? "Guest Mode" : user.email;
    document.getElementById("user-email-display").textContent = user.isAnonymous ? "Guest Mode" : user.email;
    document.getElementById("user-initial").textContent = (user.email || "G")[0].toUpperCase();
    init(); 
  } else { signInAnonymously(auth); }
});

function init() { syncChat(); window.switchTab('chats'); }

// --- ACCOUNT PANE SWITCHER ---
window.setAccountView = (view) => {
    document.getElementById('view-profile').classList.toggle('hidden', view !== 'profile');
    document.getElementById('view-switch').classList.toggle('hidden', view !== 'switch');
    document.querySelectorAll('#account-panes .pane-item').forEach(el => el.classList.remove('active', 'text-slate-500'));
    document.getElementById(`pane-${view}`).classList.add('active');
};

// --- TAB SWITCHER ---
window.switchTab = (tab) => {
  tabs.forEach(t => {
    document.getElementById(`${t}-view`).classList.add('hidden');
    document.getElementById(`tab-${t}`).classList.remove('active-tab');
  });
  document.getElementById(`${tab}-view`).classList.remove('hidden');
  document.getElementById(`tab-${tab}`).classList.add('active-tab');

  // Pane Logic
  document.getElementById('chat-panes').classList.toggle('hidden', tab !== 'chats');
  document.getElementById('account-panes').classList.toggle('hidden', tab !== 'accounts');
};

// --- AUTH ACTIONS ---
window.processAuth = async () => {
    const e = document.getElementById("identity-email").value;
    const p = document.getElementById("identity-pass").value;
    try { await signInWithEmailAndPassword(auth, e, p); window.setAccountView('profile'); } 
    catch (err) { alert(err.message); }
};
window.processSignUp = async () => {
    const e = document.getElementById("identity-email").value;
    const p = document.getElementById("identity-pass").value;
    try { await createUserWithEmailAndPassword(auth, e, p); alert("Account Created!"); } 
    catch (err) { alert(err.message); }
};
window.processLogout = () => signOut(auth).then(() => location.reload());

// Swipes
function setupSwipes() {
  const mc = new Hammer(document.getElementById("swipe-zone"));
  mc.get('swipe').set({ direction: Hammer.DIRECTION_HORIZONTAL });
  mc.on("swipeleft", () => { 
    const idx = tabs.indexOf(tabs.find(t => !document.getElementById(`${t}-view`).classList.contains('hidden'))); 
    if(idx < tabs.length-1) window.switchTab(tabs[idx+1]); 
  });
  mc.on("swiperight", () => { 
    const idx = tabs.indexOf(tabs.find(t => !document.getElementById(`${t}-view`).classList.contains('hidden'))); 
    if(idx > 0) window.switchTab(tabs[idx-1]); 
  });
}
setupSwipes();

function syncChat() {
  onSnapshot(query(collection(db, "global_chat"), orderBy("timestamp", "asc")), (snap) => {
    const cont = document.getElementById("chat-container");
    cont.innerHTML = snap.docs.map(doc => {
      const d = doc.data();
      const isMe = d.uid === currentUser.uid;
      return `<div class="flex ${isMe ? 'justify-end' : 'justify-start'}"><div class="max-w-[85%] p-4 rounded-3xl text-[11px] ${isMe ? 'wvu-blue border border-[#eaaa00]/30' : 'bg-slate-900 border border-slate-800'}">${d.text}</div></div>`;
    }).join('');
  });
}
</script>
</body>
</html>
