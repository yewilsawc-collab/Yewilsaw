<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <title>ELEMENTA | Node Registration</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="style.css">

    <style>
        /* Smooth transitions for the lifecycle states */
        #auth-container { transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .success-glow { box-shadow: 0 0 50px rgba(241, 196, 15, 0.4); border-color: #f1c40f; }
        .hidden-state { display: none !important; }
    </style>
</head>
<body class="bg-[#020617] text-white flex items-center justify-center min-h-screen p-6 overflow-hidden">

    <div id="auth-container" class="elementa-glass p-10 rounded-[50px] max-w-sm w-full text-center relative z-10">
        
        <div class="w-16 h-16 bg-[#f1c40f] rounded-2xl mx-auto flex items-center justify-center shadow-[0_0_30_rgba(241,196,15,0.3)] mb-6">
            <span class="text-black font-black text-2xl">Î›</span>
        </div>

        <div id="prompt-view">
            <h2 class="text-[#f1c40f] text-[10px] font-black tracking-[0.5em] uppercase mb-2">New Node detected</h2>
            <p class="text-xs text-slate-500 mb-8 font-mono">LOCATION: ADDIS ABABA GRID</p>

            <button id="signup-btn" class="w-full bg-[#f1c40f] text-black py-4 rounded-2xl font-black uppercase tracking-widest active:scale-95 transition-all shadow-lg">
                Register Node
            </button>
            
            <p class="mt-6 text-[8px] text-slate-600 uppercase tracking-widest">Uses Android Platform Authenticator</p>
        </div>

        <div id="success-view" class="hidden-state animate-pulse">
            <h2 class="text-green-500 text-[10px] font-black tracking-[0.5em] uppercase mb-2">Registration Complete</h2>
            <p class="text-xs text-slate-300 font-mono">NODE IDENTITY: YEWILSAW CHANIE</p>
            <div class="mt-8 flex justify-center">
                <div class="w-2 h-2 bg-[#f1c40f] rounded-full mx-1"></div>
                <div class="w-2 h-2 bg-[#f1c40f] rounded-full mx-1"></div>
                <div class="w-2 h-2 bg-[#f1c40f] rounded-full mx-1"></div>
            </div>
        </div>
    </div>

    <div class="fixed inset-0 pointer-events-none opacity-20">
        <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-[#f1c40f] rounded-full blur-[150px]"></div>
    </div>

    <script type="module">
        // Import the biometric logic from your file
        import { authenticateNode } from './security.js';

        const signupBtn = document.getElementById('signup-btn');
        const promptView = document.getElementById('prompt-view');
        const successView = document.getElementById('success-view');
        const container = document.getElementById('auth-container');

        signupBtn.addEventListener('click', async () => {
            console.log("Initializing Biometric Registration...");
            
            // This triggers the Android system prompt
            const success = await authenticateNode();

            if (success) {
                // Physical Haptic Confirmation for Android
                if ("vibrate" in navigator) navigator.vibrate([100, 50, 100]);

                // Transition UI
                promptView.classList.add('hidden-state');
                successView.classList.remove('hidden-state');
                container.classList.add('success-glow');
                
                console.log("Node Registered on Android Grid.");
                
                // Redirect or unlock further logic after 2 seconds
                setTimeout(() => {
                    // window.location.href = 'feed.html'; // Example redirect
                }, 2000);
            } else {
                alert("Registration Failed. Ensure you are on HTTPS and have a screen lock set.");
            }
        });
    </script>
</body>
</html>
