<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personal Messaging Site</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ðŸ”‘ Firebase Config: Replace with your actual values from Firebase Console -->
  <script id="firebase-config" type="application/json">
  {
    "apiKey": "AIzaSyB9fmgduk-bcSRTPL6FdcKKgqvTtQoICpE",
    "authDomain": "university-outreach-log.firebaseapp.com",
    "projectId": "university-outreach-log",
    "storageBucket": "university-outreach-log.firebasestorage.app",
    "messagingSenderId": "566149647802",
    "appId": "1:566149647802:web:490c7cc3d10b7cd7732183"
  }
  </script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col font-sans">

  <!-- Header -->
  <header class="p-4 bg-gray-800 flex justify-between items-center">
    <h1 class="text-lg font-bold text-blue-400">Personal Messaging Site</h1>
    <span id="stats-total" class="text-sm text-emerald-400">0 Messages</span>
  </header>

  <!-- Chat Container -->
  <main class="flex-1 p-4 overflow-y-auto" id="chat-container"></main>

  <!-- Footer Input -->
  <footer class="p-4 bg-gray-800">
    <form id="chat-form" class="flex gap-2">
      <input id="chat-input" type="text" autocomplete="off" placeholder="Type a message..."
             class="flex-1 bg-gray-700 border border-gray-600 rounded-lg py-2 px-3 text-sm text-white focus:ring-2 focus:ring-blue-500 outline-none" />
      <button type="submit" class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded-lg text-white">Send</button>
    </form>
  </footer>

  <!-- Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, orderBy, query } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

    // Firebase setup
    const config = JSON.parse(document.getElementById("firebase-config").textContent);
    const app = initializeApp(config);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ðŸ”‘ Gemini API key: Replace with your own from Google AI Studio
    const GEMINI_KEY = "AIzaSyDRHoimQpL6x1475X-KdA2cUmB7svg5-Gg";

    // Sign in anonymously
    signInAnonymously(auth);

    // Ask Gemini AI
    async function askAI(message) {
      try {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ contents: [{ parts: [{ text: message }] }] })
        });
        const data = await res.json();
        return data?.candidates?.[0]?.content?.parts?.[0]?.text || "âš ï¸ No AI response.";
      } catch (e) {
        return "âš ï¸ AI connection error.";
      }
    }

    // Handle chat form
    document.getElementById("chat-form").onsubmit = async (e) => {
      e.preventDefault();
      const input = document.getElementById("chat-input");
      const text = input.value.trim();
      if (!text) return;

      await addDoc(collection(db, "messages"), { role: "user", text, timestamp: Date.now() });
      input.value = "";

      const reply = await askAI(text);
      await addDoc(collection(db, "messages"), { role: "ai", text: reply, timestamp: Date.now() });
    };

    // Render chat in real time
    const q = query(collection(db, "messages"), orderBy("timestamp"));
    onSnapshot(q, (snap) => {
      const container = document.getElementById("chat-container");
      const docs = snap.docs.map(d => d.data());
      document.getElementById("stats-total").textContent = `${docs.length} Messages`;
      container.innerHTML = docs.map(m => `
        <div class="flex ${m.role === 'user' ? 'justify-end' : 'justify-start'} mb-2">
          <div class="max-w-[75%] p-3 rounded-lg text-sm ${m.role === 'user' ? 'bg-blue-600 text-white' : 'bg-gray-700 text-gray-200'}">
            ${m.text}
          </div>
        </div>
      `).join('');
      container.scrollTop = container.scrollHeight;
    });
  </script>
</body>
</html>
